<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="clr-namespace:Kardamon.Controls"
             x:Name="Control"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Kardamon.Controls.AudioVisual">
    <UserControl.Styles>

        <Style Selector="Rectangle">
            <Setter Property="Width" Value="4" />
            <Setter Property="VerticalAlignment" Value="Bottom" />
            <!-- Цвет берём из StyledProperty BarBrush -->
            <Setter Property="Fill"
                    Value="{Binding BarBrush, 
                                    RelativeSource={RelativeSource AncestorType=controls:AudioVisual}}" />
        </Style>

        <Style Selector="Rectangle.eq0">
            <Style.Animations>
                <Animation Duration="0:0:2"
                           IterationCount="Infinite">
                    <KeyFrame Cue="0%">
                        <Setter Property="Height" Value="8" />
                    </KeyFrame>
                    <KeyFrame Cue="40%">
                        <Setter Property="Height" Value="{Binding #Control.Bounds.Height}" />
                    </KeyFrame>
                    <KeyFrame Cue="80%">
                        <Setter Property="Height" Value="16" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="Height" Value="8" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <Style Selector="Rectangle.eq1">
            <Style.Animations>
                <Animation Duration="0:0:1.0"
                           IterationCount="Infinite">
                    <KeyFrame Cue="0%">
                        <Setter Property="Height" Value="10" />
                    </KeyFrame>
                    <KeyFrame Cue="35%">
                        <Setter Property="Height" Value="{Binding #Control.Bounds.Height}" />
                    </KeyFrame>
                    <KeyFrame Cue="70%">
                        <Setter Property="Height" Value="18" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="Height" Value="10" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <Style Selector="Rectangle.eq2">
            <Style.Animations>
                <Animation Duration="0:0:1.2"
                           IterationCount="Infinite">
                    <KeyFrame Cue="0%">
                        <Setter Property="Height" Value="6" />
                    </KeyFrame>
                    <KeyFrame Cue="30%">
                        <Setter Property="Height" Value="{Binding #Control.Bounds.Height}" />
                    </KeyFrame>
                    <KeyFrame Cue="65%">
                        <Setter Property="Height" Value="20" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="Height" Value="{Binding #Control.Bounds.Height}" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <Style Selector="Rectangle.eq3">
            <Style.Animations>
                <Animation Duration="0:0:2.9"
                           IterationCount="Infinite">
                    <KeyFrame Cue="0%">
                        <Setter Property="Height" Value="12" />
                    </KeyFrame>
                    <KeyFrame Cue="25%">
                        <Setter Property="Height" Value="{Binding #Control.Bounds.Height}" />
                    </KeyFrame>
                    <KeyFrame Cue="60%">
                        <Setter Property="Height" Value="22" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="Height" Value="12" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

    </UserControl.Styles>

    <Border CornerRadius="4"
            Padding="4">
        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Spacing="2">

            <!-- 20 столбиков, стили eq0..eq3 по кругу -->
            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>

            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>

            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>

            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>

            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>

            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>

            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>

            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>
            <Rectangle Classes="eq2"/>
            <Rectangle Classes="eq3"/>

            <Rectangle Classes="eq0"/>
            <Rectangle Classes="eq1"/>

        </StackPanel>
    </Border>
</UserControl>
