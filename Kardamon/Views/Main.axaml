<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:Kardamon.ViewModels"
             xmlns:controls="clr-namespace:Kardamon.Controls"
             xmlns:views="clr-namespace:Kardamon.Views"
             xmlns:avalonia="https://github.com/projektanker/icons.avalonia"
             xmlns:behaviors="clr-namespace:Kardamon.Behaviors"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Kardamon.Views.Main"
             x:DataType="viewModels:MainViewModel">
    <UserControl.Styles>
        <Style Selector="Button.CommandBarBtn">
            <Setter Property="Background">
                <LinearGradientBrush StartPoint="0% 0%"
                                     Opacity="0.2"
                                     EndPoint="100% 100%">
                    <GradientStop Offset="0.0" Color="DimGray" />
                    <GradientStop Offset="0.5" Color="DimGray" />
                    <GradientStop Offset="1.0" Color="LightGray" />
                </LinearGradientBrush>
            </Setter>
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="Foreground" Value="#FFF" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Border BorderThickness="1"
                            CornerRadius="0"
                            Padding="16,8"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}">
                        <Grid>
                            <avalonia:Icon FontSize="22"
                                           ClipToBounds="False"
                                           Value="{TemplateBinding Tag}"
                                           Margin="0,0,0,0">
                                <avalonia:Icon.Foreground>
                                    <LinearGradientBrush StartPoint="0% 0%"
                                                         Opacity="0.8"
                                                         EndPoint="100% 100%">
                                        <GradientStop Offset="0.0" Color="LightGray" />
                                        <GradientStop Offset="0.5" Color="White" />
                                        <GradientStop Offset="1.0" Color="LightGray" />
                                    </LinearGradientBrush>
                                </avalonia:Icon.Foreground>
                            </avalonia:Icon>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>
        <Style Selector="Button.CommandBarBtn:pointerover">
            <Setter Property="Background">
                <LinearGradientBrush StartPoint="0% 0%"
                                     Opacity="0.2"
                                     EndPoint="100% 100%">
                    <GradientStop Offset="0.0" Color="DimGray" />
                    <GradientStop Offset="0.5" Color="DimGray" />
                    <GradientStop Offset="1.0" Color="LightGray" />
                </LinearGradientBrush>
            </Setter>
            <Setter Property="BorderBrush">
                <LinearGradientBrush StartPoint="0% 0%"
                                     Opacity="0.5"
                                     EndPoint="100% 100%">
                    <GradientStop Offset="0.0" Color="DimGray" />
                    <GradientStop Offset="0.5" Color="LightGray" />
                    <GradientStop Offset="1.0" Color="DimGray" />
                </LinearGradientBrush>
            </Setter>
        </Style>
        <Style Selector="Button.CommandBarBtn:pressed">
            <Setter Property="Background" Value="White" />
            <Setter Property="Foreground" Value="#000" />
            <Setter Property="RenderTransform" Value="scale(0.7)" />
        </Style>
        <Style Selector="Button.CommandBarBtn:pressed /template/ avalonia|Icon">
            <Setter Property="RenderTransform" Value="scale(1.4)" />
        </Style>
    </UserControl.Styles>
    <Grid>
        <DockPanel LastChildFill="True"
                   x:Name="main">
            <ContentControl DockPanel.Dock="Left"
                            Content="{Binding NavigationMenu}" />
            <ContentControl DockPanel.Dock="Bottom"
                            ClipToBounds="False"
                            ZIndex="1"
                            Content="{Binding CommandBar}">
            </ContentControl>


            <Grid>
                <ContentControl Content="{Binding CurrentPage}">
                </ContentControl>

            </Grid>

        </DockPanel>
        <Grid Background="Transparent"
              x:Name="NowPlayingModalBase"
              DataContext="{Binding $parent[views:Main].((viewModels:MainViewModel)DataContext).MiniPlayer}"
              Classes.isPresented="{Binding $parent[views:Main].((viewModels:MainViewModel)DataContext).NowPlayingModalIsPresented}">
            <!-- Classes.isPresented="{Binding $parent[views:Main].((viewModels:MainViewModel)DataContext).NowPlayingModalIsPresented}" -->
            <Grid.Styles>
                <Style Selector="Grid#NowPlayingModalBase">
                    <Setter Property="IsVisible" Value="False" />
                </Style>
                <Style Selector="Grid#NowPlayingModalBase.isPresented">
                    <Setter Property="IsVisible" Value="True" />
                </Style>
                <Style Selector="Grid#NowPlayingModalBase.isPresented Border#NowPlayingModalBackground">
                    <Style.Animations>
                        <Animation Duration="0:0:0.4"
                                   FillMode="Both">
                            <KeyFrame Cue="0%">
                                <Setter Property="Effect" Value="blur(0)" />
                            </KeyFrame>
                            <KeyFrame Cue="100%">
                                <Setter Property="Effect" Value="blur(90)" />
                            </KeyFrame>
                        </Animation>
                    </Style.Animations>
                </Style>
                <Style Selector="Grid#NowPlayingModalBase.isPresented Border#NowPlayingModalForeground">
                    <Style.Animations>
                        <Animation Duration="0:0:0.2"
                                   FillMode="Both">
                            <KeyFrame Cue="0%">
                                <Setter Property="TranslateTransform.Y" Value="500"></Setter>
                            </KeyFrame>
                            <KeyFrame Cue="100%">
                                <Setter Property="TranslateTransform.Y" Value="0"></Setter>

                            </KeyFrame>
                        </Animation>
                    </Style.Animations>
                </Style>
                <Style Selector="Grid#NowPlayingModalBase Border#NowPlayingModalBackground">
                    <Style.Animations>
                        <Animation Duration="0:0:0.4"
                                   FillMode="Both">
                            <KeyFrame Cue="100%">
                                <Setter Property="Effect" Value="blur(0)" />
                            </KeyFrame>
                            <KeyFrame Cue="0%">
                                <Setter Property="Effect" Value="blur(90)" />
                            </KeyFrame>
                        </Animation>
                    </Style.Animations>
                </Style>
                <Style Selector="Grid#NowPlayingModalBase Border#NowPlayingModalForeground">
                    <Style.Animations>
                        <Animation Duration="0:0:0.2"
                                   FillMode="Both">
                            <KeyFrame Cue="100%">
                                <Setter Property="TranslateTransform.Y" Value="500"></Setter>
                            </KeyFrame>
                            <KeyFrame Cue="0%">
                                <Setter Property="TranslateTransform.Y" Value="0"></Setter>

                            </KeyFrame>
                        </Animation>
                    </Style.Animations>
                </Style>
            </Grid.Styles>
            <Border x:Name="NowPlayingModalBackground">
                <Border.Background>
                    <VisualBrush Stretch="None" Visual="{Binding ElementName=main}"></VisualBrush>
                </Border.Background>
            </Border>
            <Border VerticalAlignment="Bottom"
                    Margin="0"
                    x:Name="NowPlayingModalForeground"
                    Background="#1E1E1E"
                    Height="300"
                    ClipToBounds="True"
                    CornerRadius="0">
                <Grid>
                    <Border CornerRadius="0"
                            Effect="blur(100)"
                            Opacity="0.5">
                        <Border.Background>
                            <ImageBrush Stretch="UniformToFill" Source="{Binding Song.Image^}"></ImageBrush>
                        </Border.Background>
                    </Border>
                    <DockPanel Margin="0">
                        <Border Height="64"
                                DockPanel.Dock="Top"
                                Background="Transparent">
                            <DockPanel LastChildFill="True"
                                       VerticalAlignment="Center">
                                <Border Width="60"
                                        Height="60"
                                        CornerRadius="10"
                                        Background="Gray">
                                    <Grid>
                                        <avalonia:Icon Value="mdi headphones"
                                                       Foreground="White"
                                                       FontSize="24">
                                        </avalonia:Icon>
                                        <Border Width="60"
                                                Height="60"
                                                DataContext="{Binding $parent[views:Main].((viewModels:MainViewModel)DataContext).MiniPlayer.Song}"
                                                CornerRadius="10">
                                            <Border.Background>
                                                <ImageBrush Source="{Binding Image^}" />
                                            </Border.Background>
                                        </Border>
                                    </Grid>
                                </Border>
                                <Button Width="64"
                                        Command="{Binding $parent[views:Main].((viewModels:MainViewModel)DataContext).ToggleNowPlayingModalCommand}"
                                        DockPanel.Dock="Right"
                                        Classes="CommandBarBtn"
                                        Height="64"
                                        VerticalAlignment="Center"
                                        Margin="0,0"
                                        Tag="mdi close">
                                </Button>
                                <StackPanel VerticalAlignment="Center"
                                            Spacing="4"
                                            Margin="10,0">
                                    <TextBlock FontSize="17"
                                               TextTrimming="CharacterEllipsis"
                                               FontWeight="Regular"
                                               Text="{Binding Song.Name, FallbackValue=Не воспроизводится}" />
                                    <TextBlock FontSize="15"
                                               TextTrimming="CharacterEllipsis"
                                               FontWeight="UltraLight"
                                               Opacity="0.5"
                                               Text="{Binding Song.Artist}" />
                                </StackPanel>
                            </DockPanel>
                        </Border>
                        <StackPanel
                            DockPanel.Dock="Top">
                            <Slider Orientation="Horizontal"

                                    Height="30"
                                    ClipToBounds="False"
                                    Maximum="{Binding TotalTime}"
                                    Value="{Binding CurrentTime, FallbackValue=0}"
                                    Foreground="#fff">
                                <Slider.Styles>
                                    <Style Selector="Slider:horizontal /template/ Track">
                                        <Setter Property="DeferThumbDrag" Value="False"></Setter>
                                        <Setter Property="ClipToBounds" Value="False"></Setter>
                                        <Setter Property="Height" Value="5" />
                                    </Style>
                                    <Style
                                        Selector="Slider:horizontal /template/ RepeatButton#PART_IncreaseButton">
                                        <Setter Property="IsHitTestVisible" Value="False"></Setter>
                                        <Setter Property="Template">
                                            <ControlTemplate>
                                                <Border Height="5"
                                                        CornerRadius="0,2.5,2.5,0"
                                                        Background="Gray">
                                                </Border>
                                            </ControlTemplate>
                                        </Setter>
                                    </Style>
                                    <Style
                                        Selector="Slider:horizontal /template/ RepeatButton#PART_DecreaseButton">
                                        <Setter Property="IsHitTestVisible" Value="False"></Setter>
                                        <Setter Property="Template">
                                            <ControlTemplate>
                                                <Border Height="5"
                                                        CornerRadius="2.5,0,0,2.5"
                                                        Background="#FFF">
                                                </Border>
                                            </ControlTemplate>
                                        </Setter>
                                    </Style>
                                    <Style Selector="Slider:horizontal /template/ Thumb">
                                        <Setter Property="Width" Value="26"></Setter>
                                        <Setter Property="Height" Value="26"></Setter>
                                        <Setter Property="Background" Value="White"></Setter>
                                        <Setter Property="CornerRadius" Value="13"></Setter>
                                        <Setter Property="Template">
                                            <ControlTemplate>
                                                <Grid Background="Transparent">
                                                    <ProgressBar Background="Gray"
                                                                 Foreground="White"
                                                                 CornerRadius="2.5"
                                                                 Height="5"
                                                                 Maximum="{Binding $parent[Slider].Maximum}"
                                                                 Value="{Binding $parent[Slider].Value}">
                                                    </ProgressBar>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter>
                                    </Style>
                                    <Style Selector="Slider:horizontal:pointerover /template/ Thumb">
                                        <Setter Property="Width" Value="26"></Setter>
                                        <Setter Property="Height" Value="26"></Setter>
                                        <Setter Property="Background" Value="#FFFFFF"></Setter>
                                        <Setter Property="CornerRadius" Value="13"></Setter>
                                        <Setter Property="Template">
                                            <ControlTemplate>
                                                <Border CornerRadius="{TemplateBinding CornerRadius}"
                                                        Background="{TemplateBinding Background}">
                                                </Border>
                                            </ControlTemplate>
                                        </Setter>
                                    </Style>

                                </Slider.Styles>
                                <Interaction.Behaviors>
                                    <behaviors:SliderDragBehavior
                                        DragStartCommand="{Binding SeekToStartCommand}"
                                        Command="{Binding SeekToCommand}" />
                                </Interaction.Behaviors>
                            </Slider>
                            <Grid>
                                <TextBlock Text="{Binding CurrentTimeString, FallbackValue=00:00}"
                                           TextAlignment="Left"
                                           Width="50"
                                           HorizontalAlignment="Left"
                                           FontSize="11"
                                           VerticalAlignment="Center"
                                           FontWeight="Thin" />
                                <TextBlock Text="{Binding TotalTimeString, FallbackValue=00:00}"
                                           TextAlignment="Right"
                                           Width="50"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Right"
                                           FontSize="11"
                                           FontWeight="Thin" />
                            </Grid>
                        </StackPanel>
                        <Grid>
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Left"
                                        DockPanel.Dock="Bottom"
                                        Spacing="40"
                                        Margin="16,30"
                                        Height="48">
                                <Button Command="{Binding RewindCommand}"
                                        Height="48"
                                        Width="48">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="Transparent" />
                                        </Style>
                                        <Style Selector="Button:pressed">
                                            <Setter Property="Background" Value="Gray" />
                                        </Style>
                                    </Button.Styles>
                                    <Button.Template>
                                        <ControlTemplate>
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="0"
                                                    BorderBrush="#FFFFFF"
                                                    BorderThickness="0">
                                                <avalonia:Icon Value="mdi rewind"
                                                               FontSize="30"
                                                               Foreground="#FFF">
                                                </avalonia:Icon>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                <Button HorizontalAlignment="Center"
                                        IsEnabled="{Binding Song, Converter={x:Static ObjectConverters.IsNotNull}}"
                                        Classes.Playing="{Binding IsPlaying}"
                                        Command="{Binding TogglePlayCommand}"
                                        Height="48"
                                        Width="48">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="Transparent" />
                                        </Style>
                                        <Style Selector="Button:pressed">
                                            <Setter Property="Background" Value="Gray" />
                                        </Style>
                                        <Style Selector="Button /template/ avalonia|Icon">
                                            <Setter Property="Value" Value="mdi play" />
                                        </Style>
                                        <Style Selector="Button.Playing /template/ avalonia|Icon">
                                            <Setter Property="Value" Value="mdi pause" />
                                        </Style>
                                    </Button.Styles>
                                    <Button.Template>
                                        <ControlTemplate>
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="0"
                                                    BorderBrush="#FFFFFF"
                                                    BorderThickness="0">
                                                <avalonia:Icon FontSize="30"
                                                               Foreground="#FFF">
                                                </avalonia:Icon>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                <Button Command="{Binding ForwardCommand}"
                                        Height="48"
                                        DockPanel.Dock="Right"
                                        Width="48">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="Transparent" />
                                        </Style>
                                        <Style Selector="Button:pressed">
                                            <Setter Property="Background" Value="Gray" />
                                        </Style>
                                    </Button.Styles>
                                    <Button.Template>
                                        <ControlTemplate>
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="0"
                                                    BorderBrush="#FFFFFF"
                                                    BorderThickness="0">
                                                <avalonia:Icon Value="mdi fast-forward"
                                                               Foreground="#FFF"
                                                               FontSize="30">
                                                </avalonia:Icon>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </StackPanel>
                        </Grid>
                        </DockPanel>
                </Grid>

            </Border>
        </Grid>
    </Grid>

</UserControl>